BEGIN

DECLARE n Int DEFAULT 0;

DECLARE i Int DEFAULT 0;

DECLARE m Int DEFAULT 0;

DECLARE j Int DEFAULT 0;

declare litemid2 int DEFAULT 0;
declare dateTag date;
declare dateTag2 date;
declare dateadddate datetime;

declare decQty2 decimal(10,2) default 0;
declare strUser varchar(20);
declare strTipe varchar(20);

declare intitem varchar(20) DEFAULT '';
declare strnotrans varchar(20) DEFAULT '';
declare strnotag varchar(20) default '';
declare strop varchar(100) default '';
declare strqc varchar(100) default '';
declare strmesin varchar(20) default '';
declare lnoplan int default 0;
declare lnoplan2 int default 0;
declare lshiftid int default 0;
declare strnotrans2 varchar(20) DEFAULT '';
declare strnotag2 varchar(20) default '';

SELECT COUNT(c.notrans) into n from tbltagc c join tbltag b on b.notag=c.notagblowing and c.notagblowing<>'' 
        where b.berat<>0 and c.adddate2>='2025-08-31' and b.adddate2>='2025-08-31' ;
SET i=0;

WHILE i<n DO 

        SELECT c.notag,c.adddate2,c.editby,b.berat,c.notrans,b.itemid,c.editdate,'','','',0,1,'cutting',b.notag,b.notrans,b.adddate2
        into strnotag,dateTag2,strUser,decQty2,strnotrans,litemid2,dateadddate,strop,strqc,strmesin,
        lnoplan,lshiftid,strtipe,strnotag2,strnotrans2,datetag2
        FROM tbltagc c join tbltag b on b.notag=c.notagblowing and c.notagblowing<>'' 
        where b.berat<>0 and c.adddate2>='2025-08-31' and b.adddate2>='2025-08-31' limit i,1 ;

        if strnotrans<>'' then
                call updatetbltransnotag2 (dateTag,strnotag,strnotrans,strtipe,strnotag2,strnotrans2,dateTag2,
            dateadddate,struser,'add',strop,strqc,strmesin,litemid2,decQty2,lnoplan,lshiftid,lnoplan); 
        end if;
    SET i = i + 1;

END WHILE;

SELECT COUNT(c.notrans) into n from tbltagc c join tblimport b on b.notag=c.notagblowing and c.notagblowing<>'' 
        where b.berat<>0 and c.adddate2>='2025-08-31' and b.tgltag>='2025-08-31' ;
SET i=0;

WHILE i<n DO 

        SELECT c.notag,c.adddate2,c.editby,b.berat,c.notrans,b.itemid,c.editdate,'','','',0,1,'cutting',b.notag,b.notrans,b.tgltag
        into strnotag,dateTag2,strUser,decQty2,strnotrans,litemid2,dateadddate,strop,strqc,strmesin,
        lnoplan,lshiftid,strtipe,strnotag2,strnotrans2,datetag2
        FROM tbltagc c join tblimport b on b.notag=c.notagblowing and c.notagblowing<>'' 
        where b.berat<>0 and c.adddate2>='2025-08-31' and b.tgltag>='2025-08-31' limit i,1 ;

        if strnotrans<>'' then
                call updatetbltransnotag2 (dateTag,strnotag,strnotrans,strtipe,strnotag2,strnotrans2,dateTag2,
            dateadddate,struser,'add',strop,strqc,strmesin,litemid2,decQty2,lnoplan,lshiftid,lnoplan); 
        end if;
    SET i = i + 1;

END WHILE;

SELECT COUNT(c.notrans) into n from tbltagc c join tbltagp b on b.notag=c.notagprinting and c.notagprinting<>'' 
        where b.berat<>0 and c.adddate2>='2025-08-31' and b.adddate2>='2025-08-31' ;
SET i=0;

WHILE i<n DO 

        SELECT c.notag,c.adddate2,c.editby,b.berat,c.notrans,b.itemid,c.editdate,'','','',1,1,'cutting',b.notag,b.notrans,b.adddate2
        into strnotag,dateTag2,strUser,decQty2,strnotrans,litemid2,dateadddate,strop,strqc,strmesin,
        lnoplan,lshiftid,strtipe,strnotag2,strnotrans2,datetag2
        FROM tbltagc c join tbltagp b on b.notag=c.notagprinting and c.notagprinting<>'' 
        where b.berat<>0 and c.adddate2>='2025-08-31' and b.adddate2>='2025-08-31' limit i,1 ;

        if strnotrans<>'' then
                call updatetbltransnotag2 (dateTag,strnotag,strnotrans,strtipe,strnotag2,strnotrans2,dateTag2,
            dateadddate,struser,'add',strop,strqc,strmesin,litemid2,decQty2,lnoplan,lshiftid,lnoplan); 
        end if;
    SET i = i + 1;

END WHILE;

SELECT COUNT(c.notrans) into n from tbltagjb c join tbltag b on b.notag=c.notag  
        where b.berat<>0 and c.tgljb>='2025-08-31' and b.adddate2>='2025-08-31' and c.tipejb='jualb' and c.berat<>0 ;
SET i=0;

WHILE i<n DO 

        SELECT c.notag,c.tgljb,c.editby,b.berat,c.notrans,b.itemid,c.editdate,'','',''
        ,0,1,'jualb',b.notag,b.notrans,b.adddate2
        into strnotag,dateTag2,strUser,decQty2,strnotrans,litemid2,dateadddate,strop,strqc,strmesin,
        lnoplan,lshiftid,strtipe,strnotag2,strnotrans2,datetag2
        FROM tbltagjb c join tbltag b on b.notag=c.notag  
        where b.berat<>0 and c.tgljb>='2025-08-31' and b.adddate2>='2025-08-31' and c.tipejb='jualb' and c.berat<>0 limit i,1 ;

        if strnotag<>'' then
                call updatetbltransnotag2 (dateTag,strnotag,strnotrans,strtipe,strnotag2,strnotrans2,dateTag2,
            dateadddate,struser,'add',strop,strqc,strmesin,litemid2,decQty2,lnoplan,lshiftid,lnoplan); 
        end if;
    SET i = i + 1;

END WHILE;

SELECT COUNT(c.notrans) into n from tbltagjb c join tblimport b on b.notag=c.notag  
        where b.berat<>0 and c.tgljb>='2025-08-31' and b.tgltag>='2025-08-31' and c.tipejb='jualb' and c.berat<>0 ;
SET i=0;

WHILE i<n DO 

        SELECT c.notag,c.tgljb,c.editby,b.berat,c.notrans,b.itemid,c.editdate,'','',''
        ,0,1,'jualb',b.notag,b.notrans,b.adddate2
        into strnotag,dateTag2,strUser,decQty2,strnotrans,litemid2,dateadddate,strop,strqc,strmesin,
        lnoplan,lshiftid,strtipe,strnotag2,strnotrans2,datetag2
        FROM tbltagjb c join tblimport b on b.notag=c.notag  
        where b.berat<>0 and c.tgljb>='2025-08-31' and b.tgltag>='2025-08-31' and c.tipejb='jualb' and c.berat<>0 limit i,1 ;

        if strnotag<>'' then
                call updatetbltransnotag2 (dateTag,strnotag,strnotrans,strtipe,strnotag2,strnotrans2,dateTag2,
            dateadddate,struser,'add',strop,strqc,strmesin,litemid2,decQty2,lnoplan,lshiftid,lnoplan); 
        end if;
    SET i = i + 1;

END WHILE;

SELECT COUNT(c.notrans) into n from tbltagjb c join tbltagp b on b.notag=c.notag  
        where b.berat<>0 and c.tgljb>='2025-08-31' and b.adddate2>='2025-08-31' and c.tipejb='jualp' and c.berat<>0;
SET i=0;

WHILE i<n DO 

        SELECT c.notag,c.tgljb,c.editby,b.berat,c.notrans,b.itemid,c.editdate,'','',''
        ,1,1,'jualp',b.notag,b.notrans,b.adddate2
        into strnotag,dateTag2,strUser,decQty2,strnotrans,litemid2,dateadddate,strop,strqc,strmesin,
        lnoplan,lshiftid,strtipe,strnotag2,strnotrans2,datetag2
        FROM tbltagjb c join tbltagp b on b.notag=c.notag  
        where b.berat<>0 and c.tgljb>='2025-08-31' and b.adddate2>='2025-08-31' and c.tipejb='jualp' and c.berat<>0 limit i,1 ;

        if strnotag<>'' then
                call updatetbltransnotag2 (dateTag,strnotag,strnotrans,strtipe,strnotag2,strnotrans2,dateTag2,
            dateadddate,struser,'add',strop,strqc,strmesin,litemid2,decQty2,lnoplan,lshiftid,lnoplan); 
        end if;
    SET i = i + 1;

END WHILE;

End
